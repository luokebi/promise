function Promise(e){function r(){n("resolve",arguments)}function t(){var e=Array.prototype.slice.call(arguments);s._reason=e,s._status="rejected",n("reject",arguments)}function n(e,r){var r=Array.prototype.slice.call(r),n=s._thens.shift();if("resolve"==e)var o=n?n.resolve:null;else if("reject"==e)var o=n?n.reject:null;if(o)try{var i=o.apply(null,r);if(i instanceof Promise)i._thens=s._thens;else{var l=Promise.resolve(i);l._thens=s._thens}}catch(u){return t(u)}else if("reject"==e){var l=Promise.reject(s._reason);l._thens=s._thens,l._status=s._status}}var s=this;this._thens=[],this._status="pending",this._reason=null,setTimeout(function(){e.call(null,r,t)})}Promise.prototype.then=function(e,r){return this._thens.push({resolve:e,reject:r}),this},Promise.prototype.catch=function(e){return this.then(null,e)},Promise.resolve=function(){var e=Array.prototype.slice.call(arguments),r=new Promise(function(r){r.apply(null,e)});return r},Promise.reject=function(){var e=Array.prototype.slice.call(arguments),r=new Promise(function(r,t){t.apply(null,e)});return r},Promise.all=function(e){for(var r=len=e.length,t=Promise.deferred(),n=[],s=0;len>s;s++)!function(s){var o=e[s];o.then(function(e){n[s]=e,r--,0===r&&t.resolve(n)})}(s);return t.promise},Promise.any=function(e){for(var r=e.length,t=Promise.deferred(),n=[],s=0;r>s;s++)!function(r){var s=e[r];s.then(function(e){n[r]=e,n.length>0&&t.resolve(e)})}(s);return t.promise},Promise.queue=function(e){for(var r=e[0](),t=1,n=e.length;n>t;t++)!function(t){r.then(e[t])}(t);return r},Promise.deferred=function(){var e={};return e.promise=new Promise(function(r,t){e.resolve=r,e.reject=t}),e};